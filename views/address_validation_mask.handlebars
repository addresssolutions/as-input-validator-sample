<div class="container" style="background-repeat: no-repeat; background-attachment: scroll;
  -webkit-background-size: cover; -moz-background-size: cover; background-size: cover; -o-background-size: cover;">

  <!-- Form Name -->
  <form id="contact_form" method="POST" class="form-horizontal" action="/address_validation_mask" role="form">

    <fieldset>

      <div class="page-header">
        <div class="jumbotron">
          <div class="form-group">
            <div class="col-sm-3">
              <img src="/img/aslogo.png" alt="AS Address Solutions GmbH" height=150px>
            </div>
            <div class="col-sm-7">
              <h1>{{VariousText.head1}}</h1>
              <p>{{VariousText.head2}}</p>
              <h5>{{VariousText.head3}}</h5>
            </div>
            <div class="form-group">
              <div class="col-sm-2">
                <div id="CountrycodeInput" data-input-name="CountrycodeInput" data-selected-country="{{Countrycode}}"></div>
                <!-- Place a button/image here for explanation
                <button class="btn btn-primary" data-toggle="tooltip" data-placement="bottom" name="btn-validate-name" id="btn-validate-name" title="Prüfen, korrigieren und strukturieren der Namensteile">
                  <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span>{{MyButtons.check}}
                </button>
              -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- flash message -->
      <div id="form_errors" class="alert alert-danger fade in" style="display:none"></div>
      <!--
      <div class="alert alert-success" role="alert" id="success_message">Success <i class="glyphicon glyphicon-thumbs-up"></i> Thanks for contacting us, we will get back to you shortly.</div>
      -->

      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

        <!-- Name Panel-->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseName">{{VariousText.head_name_box}}</a>
            </h3>
          </div>

          <div id="collapseName" class="panel-collapse collapse">
            <div class="panel-body">

              <div id = "name_validation_alert_placeholder"></div>
              <!--
              <div class="alert alert-success" role="alert" id="success_message">Success <i class="glyphicon glyphicon-thumbs-up"></i> Thanks for contacting us, we will get back to you shortly.</div>
            -->
              <div class="row">

                <div class="form-group col-md-2 selectContainer has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="SalutationInput">{{FieldTitles.salutation}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                      <select class="form-control form-control-inline" id="SalutationInput" name="SalutationInput" value="{{NameElements.firstname}}" >
                        <option value="{{NameElements.salutation}}">{{NameElements.salutation}}</option>
                        {{#each SelectableSalutations}}<option value="{{key}}">{{key}}</option>
                        {{/each}}
                      </select>
                    </div>
                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                  </div>
                </div>

                <div class="form-group col-md-2 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="TitleInput">{{FieldTitles.title}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon"></i></span>
                      <input type="text" class="form-control" name="TitleInput" id="TitleInput" value="{{NameElements.title}}" data-remote="/as_validate_title">
                      <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

                <div class="form-group col-md-4 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="FirstnameInput">{{FieldTitles.firstname}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon"></i></span>
                      <input type="text" class="form-control" name="FirstnameInput" id="FirstnameInput" value="{{NameElements.firstname}}" data-minlength="2" data-remote="/as_validate_firstname" data-minlength-error="Vorname muss mind. 2 Zeichen haben" data-validate="true">
                      <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

                <div class="form-group col-md-5 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="LastnameInput">{{FieldTitles.lastname}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon"></i></span>
                      <input type="text" class="form-control" name="LastnameInput" id="LastnameInput" value="{{NameElements.lastname}}" data-remote="/as_validate_lastname">
                      <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

              </div>

              <button type="button" class="classAndDocsFormSubmit btn btn-primary btn-validate-name" data-toggle="tooltip" data-placement="bottom" name="btn-validate-name" id="btn-validate-name" title="{{MyButtons.check_name.hint}}">
                <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span>{{MyButtons.check_name.btn}}
              </button>
              <button type="button" class="classAndDocsFormSubmit btn btn-success btn-accept-name" data-toggle="tooltip" data-placement="bottom" name="btn-accept-name" id="btn-accept-name" title="{{MyButtons.ok_name.hint}}">
                <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>
              </button>
              <button type="button" class="classAndDocsFormSubmit btn btn-danger btn-restore-name" data-toggle="tooltip" data-placement="right" name="btn-restore-name" id="btn-restore-name" title="{{MyButtons.myentry.hint}}">
                <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>
              </button>

            </div>
          </div>
        </div>


        <!-- Address Panel-->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseAddress">{{VariousText.head_address_box}}</a>
            </h3>
          </div>

          <div id="collapseAddress" class="panel-collapse collapse">
            <div class="panel-body">

              <div id = "address_validation_alert_placeholder"></div>

              <div class="row">

                <div class="form-group col-md-2 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="ZIPInput">{{FieldTitles.zip}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon glyphicon-home"></i></span>
                      <input type="text" class="typeahead form-control"  data-provide="typeahead" id="ZIPInput" name="ZIPInput" placeholder="" value="" data-remote="/as_validate_zip">
                        <!--<input type="text" class="form-control" name="ZIPInput" id="ZIPInput" value="{{AddressElements.zip}}"> -->
                      <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

                <div class="form-group col-md-3 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="CityInput">{{FieldTitles.city}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon"></i></span>
                      <input type="text" class="typeahead form-control" data-provide="typeahead" id="CityInput" name="CityInput" placeholder="" value="" data-remote="/as_validate_city">
                      <!-- <input type="text" class="form-control" name="CityInput" id="CityInput" value="{{AddressElements.city}}" data-minlength="2" data-remote="/as_autosuggest_city" data-minlength-error="Ort muss mind. 2 Zeichen haben"> -->
                    </div>
                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

                <div class="form-group col-md-4 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="StreetInput">{{FieldTitles.street}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon"></i></span>
                      <input type="text" class="typeahead form-control"  data-provide="typeahead" id="StreetInput" name="StreetInput" placeholder="" value="" data-streetcheck> <!-- data-remote="/as_validate_street"> -->
                      <!-- <input type="text" class="form-control" id="StreetInput" name="StreetInput" value="{{AddressElements.street}}" data-remote="/as_validate_street"> -->
                    </div>
                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

                <div class="form-group col-md-2 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="HnrInput">{{FieldTitles.hnr}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon"></i></span>
                      <input type="text" class="form-control" name="HnrInput" id="HnrInput" value="" data-hnrcheck>
                    </div>
                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

                <div class="form-group col-md-2 has-feedback">
                  <div style = "padding-left: 10px;">
                    <label for="HnrAddInput">{{FieldTitles.hnradd}}</label>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon"></i></span>
                      <input type="text" class="form-control" name="HnrAddInput" id="HnrAddInput" value="{{AddressElements.hnradd}}">
                    </div>
                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    <div class="help-block with-errors"></div>
                  </div>
                </div>

              </div> <!-- of row-->

              <button type="button" class="classAndDocsFormSubmit btn btn-primary btn-validate-address" data-toggle="tooltip" data-placement="bottom" name="btn-validate-address" id="btn-validate-address" title="{{MyButtons.check_address.hint}}">
                <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span>{{MyButtons.check_address.btn}}
              </button>
              <button type="button" class="classAndDocsFormSubmit btn btn-danger btn-restore-address" data-toggle="tooltip" data-placement="right" name="btn-restore-address" id="btn-restore-address" title="{{MyButtons.myentry.hint}}">
                <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>
              </button>

            </div>

            <div class="panel panel-default">
              <div class="panel-footer">
                <button type="submit" class="classAndDocsFormSubmit btn btn-success btn-submit" data-toggle="tooltip" data-placement="right" name="btn-submit" id="btn-submit" title="{{MyButtons.submit.hint}}" disabled>
                  <span class="glyphicon glyphicon-save" aria-hidden="true"></span></span>{{MyButtons.submit.btn}}
                </button>
              </div>
            </div>

          </div>

        </div>


        <!-- Result Panel-->
        <div class="panel panel-default">

          <div class="panel-heading">
            <h3 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseResult">{{VariousText.head_result_box}}</a>
            </h3>
          </div>

          <div id="collapseResult" class="panel-collapse collapse">
            <div class="panel-body">
              <div class="container col-md-10">
                <h2>{{VariousText.success_message}}</h2>
                <p></p>
                <table class="table table-striped table-bordered">
                  <colgroup>
                       <col class="col-md-1">
                       <col class="col-md-3">
                   </colgroup>
                  <tbody>
                    <tr>
                      <td><b>{{FieldTitles.salutation}}</b></td>
                      <td>{{NameElements.salutation}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.title}}</b></td>
                      <td>{{NameElements.title}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.firstname}}</b></td>
                      <td>{{NameElements.firstname}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.lastname}}</b></td>
                      <td>{{NameElements.lastname}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.zip}}</b></td>
                      <td>{{AddressElements.zip}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.city}}</b></td>
                      <td>{{AddressElements.city}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.street}}</b></td>
                      <td>{{AddressElements.street}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.hnr}}</b></td>
                      <td>{{AddressElements.hnr}}</td>
                    </tr>
                    <tr>
                      <td><b>{{FieldTitles.hnradd}}</b></td>
                      <td>{{AddressElements.hnradd}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-footer">
                <button type="button" class="classAndDocsFormSubmit btn btn-default btn-clea-and-back" data-toggle="tooltip" data-placement="right" name="btn-clear-and-back" id="btn-clear-and-back" title="{{MyButtons.clear.hint}}">
                  <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span></span>{{MyButtons.clear.btn}}
                </button>
              </div>
            </div>

          </div>

        </div>



      </div> <!-- panel group -->

    </fieldset>

  </form>
</div><!-- /.container -->


{{#section 'jquery'}}

<script type="text/javascript">

  $(document).ready(function() {

    if (document.getElementById('FirstnameInput').value != '') {
      $("#collapseName").collapse('hide');
      $("#collapseAddress").collapse('hide');
      $("#collapseResult").collapse('show');
    }
    else {
      $("#collapseName").collapse('show');
      $("#collapseAddress").collapse('hide');
      $("#collapseResult").collapse('hide');
    }

    //for test purposes only
    var delay = ( function() {
         var timer = 0;
         return function(callback, ms) {
             clearTimeout (timer);
             timer = setTimeout(callback, ms);
         };
     })();


    var gb_disableAddressCollaps = true;
    $("#collapseAddress").on('hide.bs.collapse show.bs.collapse',  function(e) {
      if(gb_disableAddressCollaps) {
        e.preventDefault();
        name_validation_alert.error('{{VariousText.address_collapse_disabled}}');
      }
    });

    var gb_disableResultCollaps = true;
    $("#collapseResult").on('hide.bs.collapse show.bs.collapse',  function(e) {
      if(gb_disableResultCollaps) {
        e.preventDefault();
        name_validation_alert.error('{{VariousText.result_collapse_disabled}}');
      }
    });

    //https://github.com/blazeworx/flagstrap/
    $('#CountrycodeInput').flagStrap({
      countries: {
        "de": "Deutschland",
        "at": "Österreich",
        "ch": "Schweiz",
        "us": "United States",
        "fr": "France",
        "es": "España",
        "cz": "Česká republika",
        "fi": "Suomi",
        "gr": "Ελλάδα",
        "pt": "Portugal",
        "se": "Sverige",
        "bg": "България",

      },
      buttonSize: "btn-sm",
      buttonType: "btn-info",
      labelMargin: "10px",
      scrollable: false,
      //scrollableHeight: "350px",
      onSelect: function (value, element) {
        //bootbox.alert(value+ ' '+element);
        window.location.href = '/address_validation_mask?CountrycodeInput=' + value;
      }
    });

    // https://github.com/bassjobsen/Bootstrap-3-Typeahead/
    $('#ZIPInput').typeahead({
      delay: 20,
      items: 'all',
      autoSelect: false,
      afterSelect: function(item) {
        var addr = item.split(',');
        $("#ZIPInput").val(addr[0].trim());
        $("#CityInput").val(addr[1].trim());
	    },
      source: function (query, process) {
        //bootbox.alert('1:'+query);
        var value = '';
        var $form = $( this ),
          url = $form.attr( "action" );

        // Send the data using post
        var posting = $.post( url, { Action: 'ASZ',
                                     CountrycodeInput: $("#CountrycodeInput :selected").val(),
                                     ZIPInput: query,
                                     CityInput: document.getElementById('CityInput').value,
                                     StreetInput: '',
                                     MaxResults: '10' } )
        .done(function(response) {
          //bootbox.alert('1:'+response);
          var newData = [];
          $.each(response.AddressResponse, function(){
            newData.push(this.ZIPOutput + ', ' + this.CityOutput);
          });

          return process(newData);
        });
      },
      matcher: function(item) {
        var addr = item.split(',');
        var zip = addr[0].trim();
        //bootbox.alert('zip:'+zip+' query:'+this.query.trim().toLowerCase());
        if (zip.toLowerCase().indexOf(this.query.trim().toLowerCase()) != -1) {
            return true;
        }
      },
    });

    // Typeahead for City
    $('#CityInput').typeahead({
      delay: 20,
      items: 'all',
      autoSelect: false,
      afterSelect: function(item) {
        var addr = item.split(',');
        $("#ZIPInput").val(addr[0].trim());
        $("#CityInput").val(addr[1].trim());
	    },
      //items: 'all',
      source: function (query, process) {
        //bootbox.alert('1:'+query);
        var value = '';
        var $form = $( this ),
          url = $form.attr( "action" );

        // Send the data using post
        var posting = $.post( url, { Action: 'ASZ',
                                     CountrycodeInput: $("#CountrycodeInput :selected").val(),
                                     ZIPInput: document.getElementById('ZIPInput').value,
                                     CityInput: query,
                                     StreetInput: '',
                                     MaxResults: '10' } )
        .done(function(response) {
          var newData = [];
          $.each(response.AddressResponse, function(){
            if (this.CitySubOutput != '') newData.push(this.ZIPOutput + ', ' + this.CityOutput  + ', ' + this.CitySubOutput);
            else newData.push(this.ZIPOutput + ', ' + this.CityOutput);
          });
          return process(newData);
        });
      },
      matcher: function(item) {
        return true;
      },
    });

    // Typeahead for Street
    $('#StreetInput').typeahead({
      delay: 20,
      items: 'all',
      autoSelect: false,
      afterSelect: function(item) {
        var addr = item.split(',');
        $("#ZIPInput").val(addr[0].trim());
        $("#CityInput").val(addr[1].trim());
        $("#StreetInput").val(addr[2].trim());
	    },
      //items: 'all',
      source: function (query, process) {
        //bootbox.alert('1:'+query);
        var value = '';
        var $form = $( this ),
          url = $form.attr( "action" );

        // Send the data using post
        var posting = $.post( url, { Action: 'ASZ',
                                     CountrycodeInput: $("#CountrycodeInput :selected").val(),
                                     ZIPInput: document.getElementById('ZIPInput').value,
                                     CityInput: document.getElementById('CityInput').value,
                                     StreetInput: query,
                                     MaxResults: '10' } )
        .done(function(response) {
          //bootbox.alert('response:'+response.AddressResponse);
          var newData = [];
          $.each(response.AddressResponse, function(){
            newData.push(this.ZIPOutput + ', ' + this.CityOutput + ', ' + this.StreetOutput);
          });
          return process(newData);
        });
      },
      matcher: function(item) {
        return true;
      },
    });


    $('[data-toggle="tooltip"]').tooltip({container: 'body'});

    $("#btn-accept-name").hide();
    $("#btn-restore-name").hide();
    //$("#btn-accept-address").hide();
    $("#btn-restore-address").hide();

    var ls_ok_name_btn = '<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> {{MyButtons.ok_name.btn}}';
    var ls_myentry_btn = '<span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> {{MyButtons.myentry.btn}}';

    var ls_status491 = '{{StatusMessages.status491}}';
    var ls_status492 = '{{StatusMessages.status492}}';

    name_validation_alert = function() {}
    name_validation_alert.warning = function(message) {
      $('#name_validation_alert_placeholder').html('<div class="alert alert-warning fade in"><a class="close" data-dismiss="alert">×</a><span><strong>Info! </strong> '+message+'</span></div>')
    }
    name_validation_alert.success = function(message) {
      $('#name_validation_alert_placeholder').html('<div class="alert alert-success fade in"><a class="close" data-dismiss="alert">×</a><span><strong>OK! </strong> '+message+'</span></div>')
    }
    name_validation_alert.error = function(message) {
      $('#name_validation_alert_placeholder').html('<div class="alert alert-danger fade in"><a class="close" data-dismiss="alert">×</a><span><strong>Error!: </strong> '+message+'</span></div>')
    }
    name_validation_alert.hide = function() {
      $('#name_validation_alert_placeholder').html('');
    }

    address_validation_alert = function() {}
    address_validation_alert.warning = function(message) {
      $('#address_validation_alert_placeholder').html('<div class="alert alert-warning fade in"><a class="close" data-dismiss="alert">×</a><span><strong>Info! </strong> '+message+'</span></div>')
    }
    address_validation_alert.success = function(message) {
      $('#address_validation_alert_placeholder').html('<div class="alert alert-success fade in"><a class="close" data-dismiss="alert">×</a><span><strong>OK! </strong> '+message+'</span></div>')
    }
    address_validation_alert.error = function(message) {
      $('#address_validation_alert_placeholder').html('<div class="alert alert-danger fade in"><a class="close" data-dismiss="alert">×</a><span><strong>Error!: </strong> '+message+'</span></div>')
    }
    address_validation_alert.hide = function() {
      $('#address_validation_alert_placeholder').html('');
    }

    // generate message if not all neccessary fields are present
    function getNameErrMsg(salutation, firstname, lastname) {
      var ls_name_errmsg = '';
      if (salutation == '') {
        ls_name_errmsg = ls_name_errmsg + "{{FieldTitles.salutation}} {{StatusMessages.mandatory}}";
      }
      if (firstname == '') {
        if (ls_name_errmsg != '') {
          ls_name_errmsg = ls_name_errmsg + ", ";
        }
        ls_name_errmsg = ls_name_errmsg + "{{FieldTitles.firstname}} {{StatusMessages.mandatory}}";
      }
      if (lastname == '') {
        if (ls_name_errmsg != '') {
          ls_name_errmsg = ls_name_errmsg + ", ";
        }
        ls_name_errmsg = ls_name_errmsg + "{{FieldTitles.lastname}} {{StatusMessages.mandatory}}";
      }
      return ls_name_errmsg;
    }

    // generate message if not all neccessary fields are present
    function getAddressErrMsg(zip, city, street) {
      var ls_address_errmsg = '';
      if (zip == '') {
        ls_address_errmsg = ls_address_errmsg + "{{FieldTitles.zip}} {{StatusMessages.mandatory}}";
      }
      if (city == '') {
        if (ls_address_errmsg != '') {
          ls_address_errmsg = ls_address_errmsg + ", ";
        }
        ls_address_errmsg = ls_address_errmsg + "{{FieldTitles.city}} {{StatusMessages.mandatory}}";
      }
      if (street == '') {
        if (ls_address_errmsg != '') {
          ls_address_errmsg = ls_address_errmsg + ", ";
        }
        ls_address_errmsg = ls_address_errmsg + "{{FieldTitles.street}} {{StatusMessages.mandatory}}";
      }
      return ls_address_errmsg;
    }

    // generate message if hnr is ok and fits into ZIP
    function getHnrWarning(hnrstatus) {
      var ls_hnr_msg = '';
      if (hnrstatus == 'N') {
        ls_hnr_msg = ls_hnr_msg + "{{StatusMessages.hnr_missing}}";
      }
      else if (hnrstatus == '0') {
        ls_hnr_msg = ls_hnr_msg + "{{StatusMessages.hnr_not_ok}}";
      }
      return ls_hnr_msg;
    }


    // if we have more than one submit button, then
    // we need a handler outside "on submit" to determine the clicked button name
    // cf. https://forum.jquery.com/topic/determining-which-of-two-submit-buttons-were-clicked-in-a-single-form
    var buttonpressed;
    $('.classAndDocsFormSubmit').click(function() {
        buttonpressed = $(this).attr('name')
    });


    $('#contact_form').validator({
      feedback: {success: 'glyphicon-ok', error: 'glyphicon-info-sign'},
      delay: '500',
      disable: false,
      custom: {
        streetcheck: function($el) {
          //bootbox.alert('$el.val(): '+$el.val());
          // Send the data using post
          var ret = '';

          var jqhxr = $.ajax({
            url: '/as_validate_street',
            type: "get",
            data: {
              Action: 'CST',
              CountrycodeInput: $("#CountrycodeInput :selected").val(),
              ZIPInput: document.getElementById('ZIPInput').value,
              CityInput: document.getElementById('CityInput').value,
              StreetInput: $el.val(),
              MaxResults: '10'
            },
            success: function(res) {
              return
              //bootbox.alert('response:'+JSON.stringify(res));
            },
            error: function(xhr) {
              //bootbox.alert('response:'+JSON.stringify(xhr.statusText));
              ret = ret + xhr.statusText;
            },
            async: false,
          });

          return ret;
        },
        hnrcheck: function($el) {
          var value = Number($el.val());
          if(typeof(value) === 'number'){
            // yes it is numeric
            if(value % 1 === 0){
              // yes it's an integer.
            } else {
              return "{{StatusMessages.hnr_not_numeric}}";
            }
          } else {
            return "{{StatusMessages.hnr_not_numeric}}";
          }
        }
      },
    }).on('submit', function(e) {
      // delete previous message
      name_validation_alert.hide();
      address_validation_alert.hide();

      if (e.isDefaultPrevented()) {
        // we want to submit at all
        this.submit();
      }
    });


    $('#btn-clear-and-back').on("click", function(e) {
      bootbox.alert('sdfsdf');
      window.location.href = '/address_validation_mask?CountrycodeInput=' + $("#CountrycodeInput :selected").val();
    });


    $('#btn-validate-name').on("click", function(e) {
      // Prevent form submission
      e.preventDefault();

      name_validation_alert.hide();

      // hide button to destroy tooltip, otherwise it may be resident on screen
      $("#btn-validate-name").hide();

      // set Label to Original
      $("label[for='SalutationInput']").text('{{FieldTitles.salutation}}');
      $("label[for='TitleInput']").text('{{FieldTitles.title}}');
      $("label[for='FirstnameInput']").text('{{FieldTitles.firstname}}');
      $("label[for='LastnameInput']").text('{{FieldTitles.lastname}}');

      // following variables are global (cause they aren't defined locally)
      // cf. https://www.w3schools.com/js/js_scope.asp
      // so we can get their values on pressed restore button (see below)
      ls_salutation=document.getElementById('SalutationInput').value;
      ls_title=document.getElementById('TitleInput').value;
      ls_firstname=document.getElementById('FirstnameInput').value;
      ls_lastname=document.getElementById('LastnameInput').value;

      var value = '';
      var $form = $( this ),
      url = $form.attr( "action" );

      var posting = $.post( url, { Action: 'VN',
      // VersionInput: '1',
      CountrycodeInput: $("#CountrycodeInput :selected").val(),
      SalutationInput: document.getElementById('SalutationInput').value,
      TitleInput: document.getElementById('TitleInput').value,
      FirstnameInput: document.getElementById('FirstnameInput').value,
      LastnameInput: document.getElementById('LastnameInput').value } )
      .done(function(result) {
        if (ls_salutation != result.SalutationOutput) {
          $("label[for='SalutationInput']").text('{{FieldTitles.salutation}} '+result.SalutationOutputMessage);
          $("#SalutationInput").closest('.form-group').removeClass('has-success').removeClass('has-warning').addClass('has-feedback').addClass('has-warning');
          $('#SalutationInput').focus();
        }
        if (ls_title != result.TitleOutput) {
          $("label[for='TitleInput']").text('{{FieldTitles.title}} '+result.TitleOutputMessage);
          $("#TitleInput").closest('.form-group').removeClass('has-success').removeClass('has-warning').addClass('has-feedback').addClass('has-warning');
          $('#TitleInput').focus();
        }
        if (ls_firstname != result.FirstnameOutput) {
          $("label[for='FirstnameInput']").text('{{FieldTitles.firstname}} '+result.FirstnameOutputMessage);
          $("#FirstnameInput").closest('.form-group').removeClass('has-success').removeClass('has-warning').addClass('has-feedback').addClass('has-warning');
          $('#FirstnameInput').focus();
        }
        if (ls_lastname != result.LastnameOutput) {
          $("label[for='LastnameInput']").text('{{FieldTitles.lastname}} '+result.LastnameOutputMessage);
          $("#LastnameInput").closest('.form-group').removeClass('has-success').removeClass('has-warning').addClass('has-feedback').addClass('has-warning');
          $('#LastnameInput').focus();
        }

        $("#SalutationInput").val(result.SalutationOutput);
        $("#TitleInput").val(result.TitleOutput);
        $("#FirstnameInput").val(result.FirstnameOutput);
        $("#LastnameInput").val(result.LastnameOutput);

        $('#btn-accept-name').focus();

        // check if all neccessary name elements are now present
        var ls_name_errmsg = getNameErrMsg(result.SalutationOutput, result.FirstnameOutput, result.LastnameOutput);
        if (ls_name_errmsg != '') {
          $('#btn-accept-name').prop('disabled', true);
        } else {
          $('#btn-accept-name').prop('disabled', false);
        }

        $("#btn-validate-name").show();

        if (result.GeneralStatus == '1') {
          if (ls_name_errmsg == '') {
            name_validation_alert.success(result.ConversionMessage);
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html('');
          $("#btn-restore-name").hide();
        }
        else if (result.GeneralStatus == '2') {
          name_validation_alert.warning(result.ConversionMessage);
          if (ls_name_errmsg == '') {
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html(ls_myentry_btn);
          $("#btn-restore-name").show();
        }
        else if (result.GeneralStatus == '3') {
          name_validation_alert.warning(result.ConversionMessage);
          if (ls_name_errmsg == '') {
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html(ls_myentry_btn);
          $("#btn-restore-name").show();
        }
        else if (result.GeneralStatus == '4') {
          name_validation_alert.warning(result.ConversionMessage);
          if (ls_name_errmsg == '') {
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html('');
          $("#btn-restore-name").hide();
        }
        else if (result.GeneralStatus == '6') {
          name_validation_alert.warning(result.ConversionMessage);
          if (ls_name_errmsg == '') {
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html('');
          $("#btn-restore-name").hide();
        }
        else if (result.GeneralStatus == '7') {
          name_validation_alert.warning(result.ConversionMessage);
          if (ls_name_errmsg == '') {
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html(ls_myentry_btn);
          $("#btn-restore-name").show();
        }
        else if (result.GeneralStatus == '8') {
          name_validation_alert.warning(result.ConversionMessage);
          if (ls_name_errmsg == '') {
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html('');
          $("#btn-restore-name").hide();
        }
        else if (result.GeneralStatus == '9') {
          name_validation_alert.warning(result.ConversionMessage);
          if (ls_name_errmsg == '') {
            $("#btn-accept-name").html(ls_ok_name_btn);
            $("#btn-accept-name").show();
          }
          else {
            name_validation_alert.error(ls_name_errmsg);
          }
          $("#btn-restore-name").html('');
          $("#btn-restore-name").hide();
        }
          //window.location.href = '/address_validation_mask?action=edit&project=dummy';
      })
      .fail(function(jqXhr, textStatus, errorThrown) {
        if (jqXhr["status"] == 491) {
          name_validation_alert.warning(ls_status491);
          $("#btn-accept-name").html(ls_ok_name_btn);
          $("#btn-accept-name").show();
        }
        if (jqXhr["status"] == 492) {
          name_validation_alert.warning(ls_status492);
          $("#btn-accept-name").html(ls_ok_name_btn);
          $("#btn-accept-name").show();
        }
        //window.alert('ERROR: '+ jqXhr["status"] + ' Error Message: ' + jqXhr["responseJSON"]["errorMessage"] + ' ('+JSON.stringify(errorThrown)+')');
      });

    });


    $('#btn-accept-name').on("click", function(e) {

      name_validation_alert.hide();

      var ls_name_errmsg = getNameErrMsg(document.getElementById('SalutationInput').value,
                                         document.getElementById('FirstnameInput').value,
                                         document.getElementById('LastnameInput').value);
      if (ls_name_errmsg != '') {
        name_validation_alert.error(ls_name_errmsg);
      }
      else {
        // catch regular event
        e.preventDefault();
        // is used to enable address panel
        gb_disableAddressCollaps = false;

        $("#btn-accept-name").html('');
        $("#btn-accept-name").hide();
        $("#btn-restore-name").html('');
        $("#btn-restore-name").hide();
        //$("#collapseName").collapse('hide');
        $("#collapseAddress").collapse('show');
        $('#ZIPInput').focus();
      }
    });


    $('#btn-restore-name').on("click", function(e) {

      // catch regular event
      e.preventDefault();

      name_validation_alert.hide();


      // set Label to Original
      $("label[for='SalutationInput']").text('{{FieldTitles.salutation}}');
      $("label[for='TitleInput']").text('{{FieldTitles.title}}');
      $("label[for='FirstnameInput']").text('{{FieldTitles.firstname}}');
      $("label[for='LastnameInput']").text('{{FieldTitles.lastname}}');

      $("#SalutationInput").val(ls_salutation);
      $("#TitleInput").val(ls_title);
      $("#FirstnameInput").val(ls_firstname);
      $("#LastnameInput").val(ls_lastname);

      name_validation_alert.warning('Ihre Eingabe wurde wiederhergestellt');
      $("#btn-restore-name").html('');
      $("#btn-restore-name").hide();
    });


    //
    // check the address here
    //
    $('#btn-validate-address').on("click", function(e) {

      // Prevent form submission
      e.preventDefault();

      address_validation_alert.hide();

      // hide button to destroy tooltip, otherwise it may be resident on screen
      $("#btn-validate-address").hide();

      // set Label to Original
      $("label[for='ZIPInput']").text('{{FieldTitles.zip}}');
      $("label[for='CityInput']").text('{{FieldTitles.city}}');
      $("label[for='StreetInput']").text('{{FieldTitles.street}}');
      $("label[for='HnrInput']").text('{{FieldTitles.hnr}}');
      $("label[for='HnrAddInput']").text('{{FieldTitles.hnradd}}');

      // following variables are global (cause they aren't defined locally)
      // cf. https://www.w3schools.com/js/js_scope.asp
      // so we can get their values on pressed restore button (see below)
      ls_zip=document.getElementById('ZIPInput').value;
      ls_city=document.getElementById('CityInput').value;
      ls_street=document.getElementById('StreetInput').value;
      ls_hnr=document.getElementById('HnrInput').value;
      ls_hnradd=document.getElementById('HnrAddInput').value;

      var value = '';
      var $form = $( this ),
      url = $form.attr( "action" );

      var ls_hnr_msg = '';

      var posting = $.post( url, { Action: 'VA',
      CountrycodeInput: $("#CountrycodeInput :selected").val(),
      ZIPInput: document.getElementById('ZIPInput').value,
      CityInput: document.getElementById('CityInput').value,
      StreetInput: document.getElementById('StreetInput').value,
      HnrInput: document.getElementById('HnrInput').value,
      HnrAddInput: document.getElementById('HnrAddInput').value,
      MaxResults: '1' } )
      .done(function(result) {
        // enable the submit button
        $('#btn-submit').prop('disabled', false);
        gb_disableResultCollaps = false;

        //bootbox.alert('result.GeneralStatus: '+result.GeneralStatus);
        if ( (result.GeneralStatus == '1') || (result.GeneralStatus == '2') || (result.GeneralStatus == '3') || (result.GeneralStatus == '7') ) {
          //bootbox.alert('response:'+result.AddressResponse[0].StreetOutput);
          if (ls_zip != result.AddressResponse[0].ZIPOutput) {
            $("label[for='ZIPInput']").text('{{FieldTitles.zip}} '+result.AddressResponse[0].ZIPOutputMessage);
            $('#ZIPInput').focus();
          }
          if (ls_city != result.AddressResponse[0].CityOutput) {
            $("label[for='CityInput']").text('{{FieldTitles.city}} '+result.AddressResponse[0].CityOutputMessage);
            $('#CityInput').focus();
          }
          if (ls_street != result.AddressResponse[0].StreetOutput) {
            $("label[for='StreetInput']").text('{{FieldTitles.street}} '+result.AddressResponse[0].StreetOutputMessage);
            $('#StreetInput').focus();
          }
          if (ls_hnr != result.AddressResponse[0].HnrOutput) {
            $("label[for='HnrInput']").text('{{FieldTitles.hnr}} '+result.AddressResponse[0].HnrOutputMessage);
            $('#HnrInput').focus();
          }
          if (ls_hnradd != result.AddressResponse[0].HnrAddOutput) {
            $("label[for='HnrAddInput']").text('{{FieldTitles.hnradd}} '+result.AddressResponse[0].HnrAddOutputMessage);
            $('#HnrAddInput').focus();
          }

          $("#ZIPInput").val(result.AddressResponse[0].ZIPOutput);
          $("#CityInput").val(result.AddressResponse[0].CityOutput);
          $("#StreetInput").val(result.AddressResponse[0].StreetOutput);
          $("#HnrInput").val(result.AddressResponse[0].HnrOutput);
          $("#HnrAddInput").val(result.AddressResponse[0].HnrAddOutput);

          $('#btn-submit').focus();

          ls_hnr_msg = getHnrWarning(result.AddressResponse[0].StatusOutput[6]);
        }

        //bootbox.alert('Status:'+ result.GeneralStatus + result.ValidationMessage + 'hnr:' + ls_hnr_msg);
        // check if all neccessary name elements are now present
        var ls_address_errmsg = getAddressErrMsg($("#ZIPInput").val(), $("#CityInput").val(), $("#StreetInput").val());
        if (ls_address_errmsg != '') {
          $('#btn-submit').prop('disabled', true);
        }

        // show button again cause it was hidden to destroy tooltip
        $("#btn-validate-address").show();

        if (result.GeneralStatus == '1') {
          if (ls_address_errmsg == '') {
            if (ls_hnr_msg != '') {
              address_validation_alert.warning(result.ValidationMessage + '<br>' + ls_hnr_msg);
            }
            else {
              address_validation_alert.success(result.ValidationMessage);
            }
          }
          else {
            address_validation_alert.error(ls_address_errmsg);
          }
          $("#btn-restore-address").html('');
          $("#btn-restore-address").hide();
        }
        else if ( (result.GeneralStatus == '2') || (result.GeneralStatus == '3') || (result.GeneralStatus == '7') ) {
          if (ls_address_errmsg == '') {
            if (ls_hnr_msg != '') {
              address_validation_alert.warning(result.ValidationMessage + '<br>' + ls_hnr_msg);
            }
            else {
              address_validation_alert.warning(result.ValidationMessage);
            }
          }
          else {
            address_validation_alert.error(ls_address_errmsg);
          }
          $("#btn-restore-address").html(ls_myentry_btn);
          $("#btn-restore-address").show();
        }
        else {
          if (ls_address_errmsg == '') {
            address_validation_alert.warning(result.ValidationMessage);
          }
          else {
            address_validation_alert.error(ls_address_errmsg + ', ' + result.ValidationMessage);
          }
        }
      })
      .fail(function(jqXhr, textStatus, errorThrown) {
        if (jqXhr["status"] == 491) {
          address_validation_alert.warning(ls_status491);
        }
        if (jqXhr["status"] == 492) {
          address_validation_alert.warning(ls_status492);
        }
      });
    });


    $('#btn-accept-address').on("click", function(e) {

      address_validation_alert.hide();

      var ls_address_errmsg = getAddressErrMsg(ZIPInput.value, CityInput.value, StreetInput.value);
      if (ls_address_errmsg != '') {
        name_validation_alert.error(ls_name_errmsg);
      }
      else {
        // catch regular event
        e.preventDefault();
        // is used to enable address panel
        gb_disableAddressCollaps = false;

        $("#btn-accept-name").html('');
        $("#btn-accept-name").hide();
        $("#btn-restore-name").html('');
        $("#btn-restore-name").hide();
        //$("#collapseName").collapse('hide');
        $("#collapseAddress").collapse('show');
        $('#ZIPInput').focus();
      }
    });

    $('#btn-restore-address').on("click", function(e) {
      // catch regular event
      e.preventDefault();

      address_validation_alert.hide();

      // set Label to Original
      $("label[for='ZIPInput']").text('{{FieldTitles.zip}}');
      $("label[for='CityInput']").text('{{FieldTitles.city}}');
      $("label[for='StreetInput']").text('{{FieldTitles.street}}');
      $("label[for='HnrInput']").text('{{FieldTitles.hnr}}');
      $("label[for='HnrAddInput']").text('{{FieldTitles.hnradd}}');

      $("#ZIPInput").val(ls_zip);
      $("#TitleInput").val(ls_city);
      $("#StreetInput").val(ls_street);
      $("#HnrInput").val(ls_hnr);

      address_validation_alert.warning('Ihre Eingabe wurde wiederhergestellt');
      $("#btn-restore-address").html('');
      $("#btn-restore-address").hide();
    });

  });

</script>
{{/section}}
